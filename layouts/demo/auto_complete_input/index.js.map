{"version":3,"names":["debounce","ctx","length","create_if_block_1","trim","insert","target","button","anchor","getValue","i","ul","getLabel","match","li","append","set_data","t0","t0_value","create_if_block","set_custom_element_data","stylesheet_link","stylesheet_link_src_value","input","option","value","label","selected","undefined","addButton","list","stylesheet","$$props","addlabel","accessibleaddlabel","placeholder","options","oninput","threshold","onadd","highlightedOptionIndex","dispatchInputValue","text","debouncedDispatchInputValue","select","resetListFocus","getListItem","index","querySelector","$$invalidate","stylesheetResolvedPath","resolve","addButtonWidth","window","getComputedStyle","width","parentNode","host","style","setProperty","key","includes","previousIndex","Math","min","max","optionElement","setAttribute","focus","focusListItem","blur","removeAttribute","$$value"],"sources":["index.svelte"],"sourcesContent":["<svelte:options immutable={true} customElement=\"auto-complete-input\"/>\n\n<script>\n  import '../--/lib/stylesheet_link.js'\n  import debounce from './lib/debounce.js'\n\n  export let stylesheet = './styles/index.css'\n  export let addlabel = 'add'\n  export let accessibleaddlabel = addlabel\n  export let placeholder\n  export let options\n  export let oninput\n  export let threshold\n  export let value\n  export let onadd\n\n  let addButton\n  let list\n\n  const highlightedOptionIndex = { value: 0 }\n\n  $: stylesheetResolvedPath = import.meta.resolve(stylesheet)\n  $: addButtonWidth = addButton ? window.getComputedStyle(addButton).width : '0'\n  $: addButton?.parentNode.host.style.setProperty('--add-btn-width', addButtonWidth)\n\n  // eslint-disable-next-line no-unused-expressions, no-sequences\n  $: options, resetListFocus()\n\n  function dispatchInputValue ({ target: { value: text } }) {\n    oninput?.(text.trim())\n  }\n\n  const debouncedDispatchInputValue = threshold\n    ? debounce(dispatchInputValue, threshold)\n    : dispatchInputValue\n\n  function dispatchAddValue () {\n    onadd?.(value.trim())\n  }\n\n  function getValue (option) {\n    return option.value || option\n  }\n\n  function getLabel (option) {\n    return option.label || option\n  }\n\n  function select (option) {\n    value = getValue(option)\n  }\n\n  function match (option, selected) {\n    return (getValue(option) === selected) || undefined\n  }\n\n  function highlightOption ({ key }) {\n    if (!['ArrowDown', 'ArrowUp'].includes(key) || !list) {\n      return\n    }\n\n    const previousIndex = highlightedOptionIndex.value\n\n    if (key === 'ArrowDown') {\n      highlightedOptionIndex.value = Math.min(previousIndex + 1, options?.length || 0)\n    }\n\n    if (key === 'ArrowUp') {\n      highlightedOptionIndex.value = Math.max(previousIndex - 1, 0)\n    }\n\n    if (highlightedOptionIndex.value > 0 && highlightedOptionIndex.value !== previousIndex) {\n      focusListItem(highlightedOptionIndex.value)\n\n      const optionElement = getListItem(previousIndex)\n      optionElement?.blur()\n      optionElement?.removeAttribute('tabindex')\n    }\n  }\n\n  function resetListFocus () {\n    highlightedOptionIndex.value = 0\n  }\n\n  function focusListItem (index) {\n    const optionElement = getListItem(index)\n    optionElement?.setAttribute('tabindex', 0)\n    optionElement?.focus()\n  }\n\n  function getListItem (index) {\n    return list.querySelector(`:scope > li:nth-child(${index}) > button`)\n  }\n</script>\n\n<stylesheet-link src={stylesheetResolvedPath} />\n\n<input type=\"text\" bind:value on:keydown={highlightOption} {placeholder}\n  on:input={debouncedDispatchInputValue} on:focus={resetListFocus} />\n\n{#if options}\n  {#if options.length > 0}\n    <ul bind:this={list} on:keydown={highlightOption} role=\"listbox\" tabindex=\"0\">\n      {#each options as option (getValue(option))}\n        <li\n          role=\"option\"\n          title={getLabel(option)}\n          aria-selected={match(option, value)}\n        >\n          <button on:click={() => select(option)}>{getLabel(option)}</button>\n        </li>\n      {/each}\n    </ul>\n  {:else if value?.trim()}\n    <button bind:this={addButton} class=\"add\" on:click={dispatchAddValue} title={accessibleaddlabel}>\n      {addlabel}\n    </button>\n  {/if}\n{/if}\n"],"mappings":"+fAGS,sCACAA,MAAc,oB,mHAiGhBC,EAAO,GAACC,OAAS,EAACC,G,cAYbF,EAAK,IAAEG,Q,oQAEZH,EAAQ,I,+BADkEA,EAAkB,G,SAA/FI,EAESC,EAAAC,EAAAC,G,kCAF2CP,EAAgB,I,uBACjEA,EAAQ,I,iBADkEA,EAAkB,G,iFAXtFA,EAAO,I,WAAYQ,EAASR,EAAM,K,gBAAvCC,OAAIQ,GAAA,G,uJADRL,EAUKC,EAAAK,EAAAH,G,8EAV4BP,EAAe,K,2BACvCA,EAAO,I,iJAM+BW,EAASX,EAAM,Q,qIAHjDW,EAASX,EAAM,M,sBACPY,EAAMZ,EAAM,IAAEA,EAAK,K,qBAHpCI,EAMKC,EAAAQ,EAAAN,GADHO,EAAmED,EAAAP,G,kEAA1BK,EAASX,EAAM,UAAAe,EAAAC,EAAAC,G,aAHjDN,EAASX,EAAM,O,4BACPY,EAAMZ,EAAM,IAAEA,EAAK,M,oFAPvCA,EAAO,IAAAkB,EAAAlB,G,oFALUA,EAAsB,KAAAmB,EAAAC,EAAA,MAAAC,G,mDAA5CjB,EAAgDC,EAAAe,EAAAb,G,SAEhDH,EACqEC,EAAAiB,EAAAf,G,gFAD3BP,EAAe,K,YAC7CA,EAA2B,I,YAAYA,EAAc,M,kCAH3CA,EAAsB,K,yEAKvCA,EAAO,G,4IA5DDQ,EAAUe,G,OACVA,EAAOC,OAASD,C,UAGhBZ,EAAUY,G,OACVA,EAAOE,OAASF,C,UAOhBX,EAAOW,EAAQG,G,OACdlB,EAASe,KAAYG,QAAaC,C,2BArCxCC,EACAC,G,WAXOC,EAAa,sBAAoBC,G,SACjCC,EAAW,OAAKD,G,mBAChBE,EAAqBD,GAAQD,G,YAC7BG,GAAWH,G,QACXI,GAAOJ,G,QACPK,GAAOL,G,UACPM,GAASN,G,MACTP,GAAKO,G,MACLO,GAAKP,E,MAKVQ,EAAsB,CAAKf,MAAO,G,SAS/BgB,GAAsBnC,QAAUmB,MAAOiB,KAC9CL,IAAUK,EAAKtC,O,OAGXuC,EAA8BL,EAChCtC,EAASyC,EAAoBH,GAC7BG,E,SAcKG,EAAQpB,G,IACfC,EAAQhB,EAASe,G,UA+BVqB,IACPL,EAAuBf,MAAQ,C,UASxBqB,EAAaC,G,OACbjB,EAAKkB,cAAa,yBAA0BD,c,6XAtEpDE,EAAA,EAAEC,cAAqCC,QAAQpB,I,eAC/CkB,EAAA,GAAEG,EAAiBvB,EAAYwB,OAAOC,iBAAiBzB,GAAW0B,MAAQ,K,mBACxE1B,GAAW2B,WAAWC,KAAKC,MAAMC,YAAY,kBAAmBP,G,eAGvDP,G,gCAWVN,IAAQd,EAAMrB,O,cAmBQwD,IAAIA,I,KACpB,YAAa,WAAWC,SAASD,KAAS9B,E,aAI1CgC,EAAgBtB,EAAuBf,M,GAEjC,cAARmC,IACFpB,EAAuBf,MAAQsC,KAAKC,IAAIF,EAAgB,EAAG1B,GAASlC,QAAU,IAGpE,YAAR0D,IACFpB,EAAuBf,MAAQsC,KAAKE,IAAIH,EAAgB,EAAG,IAGzDtB,EAAuBf,MAAQ,GAAKe,EAAuBf,QAAUqC,EAAa,E,SAahEf,G,MAChBmB,EAAgBpB,EAAYC,GAClCmB,GAAeC,aAAa,WAAY,GACxCD,GAAeE,O,CAfbC,CAAc7B,EAAuBf,O,MAE/ByC,EAAgBpB,EAAYgB,GAClCI,GAAeI,OACfJ,GAAeK,gBAAgB,W,kDAiCH3B,EAAOpB,G,wCAPtBM,EAAI0C,E,mDAYA3C,EAAS2C,E"}